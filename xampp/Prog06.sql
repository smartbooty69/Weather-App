CREATE TABLE PERSON (
    DRIVER_IDNO VARCHAR2(20) PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    ADDRESS VARCHAR2(255)
);

CREATE TABLE CAR (
    REGNO VARCHAR2(20) PRIMARY KEY,
    MODEL VARCHAR2(50),
    YEAR INT
);

CREATE TABLE ACCIDENT (
    REPORT_NO INT PRIMARY KEY,
    ACCIDENT_DATE DATE,
    LOCATION VARCHAR2(100)
);

CREATE TABLE OWNS (
    DRIVER_IDNO VARCHAR2(20),
    REGNO VARCHAR2(20),
    PRIMARY KEY (DRIVER_IDNO, REGNO),
    FOREIGN KEY (DRIVER_IDNO) REFERENCES PERSON(DRIVER_IDNO),
    FOREIGN KEY (REGNO) REFERENCES CAR(REGNO)
);

CREATE TABLE PARTICIPATED (
    DRIVER_IDNO VARCHAR2(20),
    REGNO VARCHAR2(20),
    REPORT_NO INT,
    DAMAGE_AMOUNT INT,
    PRIMARY KEY (DRIVER_IDNO, REGNO, REPORT_NO),
    FOREIGN KEY (DRIVER_IDNO) REFERENCES PERSON(DRIVER_IDNO),
    FOREIGN KEY (REGNO) REFERENCES CAR(REGNO),
    FOREIGN KEY (REPORT_NO) REFERENCES ACCIDENT(REPORT_NO)
);

INSERT INTO PERSON VALUES (:person_id, :person_name, :address);

INSERT INTO CAR VALUES (:car_id, :car_model, :car_year);

INSERT INTO ACCIDENT VALUES (:accident_id, TO_DATE(:accident_date, 'YYYY-MM-DD'), :accident_location);

INSERT INTO OWNS VALUES (:owner_id, :car_id);

INSERT INTO PARTICIPATED VALUES (:participant_id, :car_id, :accident_id, :claim_amount);


UPDATE PARTICIPATED
SET
    DAMAGE_AMOUNT = 25000
WHERE
    REPORT_NO = 12
    AND REGNO = 'C002';

INSERT INTO ACCIDENT VALUES (16, TO_DATE('2024-09-01', 'YYYY-MM-DD'), 'Los Angeles');

INSERT INTO PARTICIPATED VALUES ('D003', 'C003', 16, 40000);

SELECT
    COUNT(DISTINCT P.DRIVER_IDNO) AS TOTAL_OWNERS
FROM
    PARTICIPATED P
    JOIN ACCIDENT A
    ON P.REPORT_NO = A.REPORT_NO
WHERE
    EXTRACT(YEAR FROM A.ACCIDENT_DATE) = 2022;

SELECT
    C.MODEL,
    COUNT(DISTINCT A.REPORT_NO) AS ACCIDENT_COUNT
FROM
    PARTICIPATED P
    JOIN CAR C
    ON P.REGNO = C.REGNO
    JOIN ACCIDENT A
    ON P.REPORT_NO = A.REPORT_NO
WHERE
    C.MODEL = 'Toyota Corolla'
GROUP BY
    C.MODEL;


-- INSERT INTO PERSON VALUES ('D001', 'Alice Johnson', '123 Elm Street, New York');
-- INSERT INTO PERSON VALUES ('D002', 'Bob Smith', '456 Oak Street, Chicago');
-- INSERT INTO PERSON VALUES ('D003', 'Charlie Brown', '789 Pine Street, San Francisco');
-- INSERT INTO PERSON VALUES ('D004', 'Diana Ross', '101 Maple Street, Boston');
-- INSERT INTO PERSON VALUES ('D005', 'Edward Norton', '202 Cedar Street, Austin');
-- INSERT INTO CAR VALUES ('C001', 'Toyota Corolla', 2020);
-- INSERT INTO CAR VALUES ('C002', 'Honda Civic', 2019);
-- INSERT INTO CAR VALUES ('C003', 'Ford Focus', 2021);
-- INSERT INTO CAR VALUES ('C004', 'Chevrolet Malibu', 2018);
-- INSERT INTO CAR VALUES ('C005', 'Tesla Model 3', 2022);
-- INSERT INTO ACCIDENT VALUES (11, TO_DATE('2022-01-10', 'YYYY-MM-DD'), 'New York');
-- INSERT INTO ACCIDENT VALUES (12, TO_DATE('2022-02-15', 'YYYY-MM-DD'), 'Chicago');
-- INSERT INTO ACCIDENT VALUES (13, TO_DATE('2022-03-20', 'YYYY-MM-DD'), 'San Francisco');
-- INSERT INTO ACCIDENT VALUES (14, TO_DATE('2022-04-25', 'YYYY-MM-DD'), 'Boston');
-- INSERT INTO ACCIDENT VALUES (15, TO_DATE('2022-05-30', 'YYYY-MM-DD'), 'Austin');
-- INSERT INTO OWNS VALUES ('D001', 'C001');
-- INSERT INTO OWNS VALUES ('D002', 'C002');
-- INSERT INTO OWNS VALUES ('D003', 'C003');
-- INSERT INTO OWNS VALUES ('D004', 'C004');
-- INSERT INTO OWNS VALUES ('D005', 'C005');
-- INSERT INTO PARTICIPATED VALUES ('D001', 'C001', 11, 10000);
-- INSERT INTO PARTICIPATED VALUES ('D002', 'C002', 12, 15000);
-- INSERT INTO PARTICIPATED VALUES ('D003', 'C003', 13, 20000);
-- INSERT INTO PARTICIPATED VALUES ('D004', 'C004', 14, 5000);
-- INSERT INTO PARTICIPATED VALUES ('D005', 'C005', 15, 30000);


-- DROP TABLE PARTICIPATED;
-- DROP TABLE OWNS;
-- DROP TABLE ACCIDENT;
-- DROP TABLE CAR;
-- DROP TABLE PERSON;
